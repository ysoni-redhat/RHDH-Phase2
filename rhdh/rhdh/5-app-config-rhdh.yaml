---
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-rhdh
  namespace: demo-project
data:
  app-config.yaml: |
    app:
      title: Red Hat Developer Hub
      baseUrl: https://rhdh.apps.cluster-qr8h2.dynamic.redhatworkshops.io
    kubernetes:
      serviceLocatorMethod:
        type: 'multiTenant'  
      clusterLocatorMethods:
        - type: config
          clusters:
            - name: openshift-cluster
              url: https://api.cluster-qr8h2.dynamic.redhatworkshops.io:6443
              authProvider: serviceAccount
              skipTLSVerify: true
              serviceAccountToken: eyJhbGciOiJSUzI1NiIsImtpZCI6IlpPT2FxRkNKSTIzTENwemFpU3R5UXVfd0V2QjNzMkNURElDN2w1SnluNEUifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZW1vLXByb2plY3QiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoicmhkaC1rOHMtc2EtdG9rZW4iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoicmhkaC1rOHMtc2EiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI3NzBkYzI3OS1hMDc3LTQ0ZWUtOWNkOS0xZTY3NTIwMDVhZTYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVtby1wcm9qZWN0OnJoZGgtazhzLXNhIn0.NKLWOKcMi36tvfuWvKYepA3krBqgGesUVCLVUSk_rHkZBlKrX9eGJT5wCgtGqozJ8DNS2_-AGJu-NZsZ19WkOzUWf0wQasHgh6O354h_UxxpvEM2wgRy74NVLMAJ1M5e9X2FIPIzQB8OuoYyfzs36wQ9otdjmmlhlfy4izoHeYx4s23HVUgdf0q1Llg4oGd7mz7iaH_fr0Nr4W5XEbkUgM49XwvqvtOmlmDz7HTEXwZzXPrw9ICBR-LeDvE_zozOlN_5bxmm21X3aHK5NsvU99pFeG40CTJ10kAXRcL4JDiTKrlB_L8Gv8EhAxo6YuQzyKKcnQzuG7J-9fdT6PAx1HAzhW1B5eXUTQbvrTMWjKObgerts-M_ZLoNZ11d8aYl-_7FZak6jSzLWvhRws5AXBneHS3PmMC6Rd5cntA_6FIRjcOBmjo6E8LJoC-gPJ2Xn3WmWKSuIYisf2WG7-meGm_lcuu57C7FbP0Y_1rhWWLIVC-e3_SWslF2ZKevkfyEB5hNs5epYE29RuwYTA_WzNCD8mNfuc06EUodHDWR4rl_m4JsKPP9a47elC2PB0PRmiet-jUPJaiyHiAIqWnmhCsezI_xRjsdV7WJ4M8E8f713GYpS5WQru-mxvNocc0ZKWMu-
              customResources:
                - group: 'route.openshift.io'
                  apiVersion: 'v1'
                  plural: 'routes'
                - group: 'tekton.dev'
                  apiVersion: 'v1'
                  plural: 'pipelineruns'
                - group: 'tekton.dev'
                  apiVersion: 'v1'
                  plural: 'taskruns'
    backend:
      auth:
        keys:
          - secret: ${BACKEND_SECRET}
      baseUrl: https://rhdh.apps.cluster-qr8h2.dynamic.redhatworkshops.io
      cors:
        origin: https://rhdh.apps.cluster-qr8h2.dynamic.redhatworkshops.io
      reading:
        allow:
          - host: raw.githubusercontent.com

      # GitHub token support for backend operations (used by scaffolder)
      integrations:
        github:
          - host: github.com
            token: ${GITHUB_TOKEN}
    integrations:
      github:
        - host: github.com
          token: ${GITHUB_TOKEN}
    auth:
      environment: production
      session:
        secret: ${BACKEND_SECRET}
      providers:
        oidc:
          production:
            metadataUrl: "https://keycloak-rhdh-operator.apps.cluster-qr8h2.dynamic.redhatworkshops.io/realms/rhdh"
            clientId: rhdh
            clientSecret: developer-hub-secret
            callbackUrl: https://rhdh.apps.cluster-qr8h2.dynamic.redhatworkshops.io/api/auth/oidc/handler/frame
            prompt: login
            signIn:
              resolvers:
                - resolver: emailMatchingUserEntityProfileEmail
                  dangerouslyAllowSignInWithoutUserInCatalog: true
      dangerouslyAllowSignInWithoutUserInCatalog: true

    signInPage: oidc

    catalog:
      providers:
        keycloakOrg:
          default:
            baseUrl: "https://keycloak-rhdh-operator.apps.cluster-qr8h2.dynamic.redhatworkshops.io"
            loginRealm: "rhdh"
            realm: "rhdh"
            clientId: rhdh
            clientSecret: developer-hub-secret
            schedule:
              frequency: { minutes: 1 }
              timeout: { minutes: 1 }
              initialDelay: { seconds: 15 }
            signIn:
              resolvers:
                - resolver: emailMatchingUserEntityProfileEmail
                  dangerouslyAllowSignInWithoutUserInCatalog: true
      locations:
        - type: url
          target: https://raw.githubusercontent.com/ysoni-redhat/RHDHSoftwareTemplate/refs/heads/main/catalog/catalog-info.yaml
    scaffolder:
      github:
        token: ${GITHUB_TOKEN}
